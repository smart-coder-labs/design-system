import{j as r}from"./jsx-runtime-u17CrQMm.js";import{r as a}from"./iframe-BQuKaBw1.js";import{c as E}from"./utils-CDN07tui.js";import"./preload-helper-PPVm8Dsz.js";async function k(c){if(typeof window>"u")return;if(window.google&&window.google.maps)return window.google;const n=document.querySelector("script[data-gmaps]");if(n)return await new Promise(l=>{n.addEventListener("load",()=>l())}),window.google;const o=document.createElement("script");return o.setAttribute("data-gmaps","1"),o.src=`https://maps.googleapis.com/maps/api/js?key=${encodeURIComponent(c)}&libraries=places`,o.async=!0,o.defer=!0,document.head.appendChild(o),await new Promise((l,m)=>{o.onload=()=>l(),o.onerror=()=>m(new Error("Failed to load Google Maps script"))}),window.google}const v=({onSelect:c,apiKey:n,placeholder:o="Search address",className:l="",minLength:m=3})=>{const[S,N]=a.useState(!1),[b,_]=a.useState(null),[f,P]=a.useState(""),[i,d]=a.useState([]),[u,g]=a.useState(-1),h=a.useRef(null),w=a.useRef(null),x=a.useRef(null);a.useEffect(()=>{let e=!0;const t=n;if(!t){_("Google Maps API key not provided. Pass the `apiKey` prop to AddressSelector.");return}return k(t).then(s=>{if(!e)return;h.current=new s.maps.places.AutocompleteService;const p=document.createElement("div");w.current=new s.maps.places.PlacesService(p),N(!0)}).catch(s=>{console.error(s),_(String(s?.message??s))}),()=>{e=!1}},[n]),a.useEffect(()=>{if(!S||!h.current)return;if(f.length<m){d([]);return}let e=!1;return h.current.getPlacePredictions({input:f},(t,s)=>{e||(d(t??[]),g(-1))}),()=>{e=!0}},[f,S,m]);const A=e=>{w.current&&w.current.getDetails({placeId:e.place_id},(t,s)=>{if(s!==window.google.maps.places.PlacesServiceStatus.OK){console.warn("PlacesService getDetails failed",s),c?.({id:e.place_id,placeId:e.place_id,description:e.description,raw:e});return}const p={id:e.place_id,placeId:e.place_id,description:e.description,address:t?.formatted_address,raw:t};t?.geometry?.location&&(p.lat=t.geometry.location.lat(),p.lng=t.geometry.location.lng()),P(t?.formatted_address??e.description??""),d([]),c?.(p)})},j=e=>{i.length!==0&&(e.key==="ArrowDown"?(e.preventDefault(),g(t=>Math.min(t+1,i.length-1))):e.key==="ArrowUp"?(e.preventDefault(),g(t=>Math.max(t-1,0))):e.key==="Enter"?(e.preventDefault(),u>=0&&u<i.length&&A(i[u])):e.key==="Escape"&&d([]))};return a.useEffect(()=>{const e=t=>{x.current&&(x.current.contains(t.target)||d([]))};return document.addEventListener("click",e),()=>document.removeEventListener("click",e)},[]),r.jsxs("div",{ref:x,className:E("relative w-full",l),children:[r.jsx("input",{type:"search",placeholder:o,value:f,onChange:e=>P(e.target.value),onKeyDown:j,className:"w-full px-3 py-2 rounded-lg border border-border-primary bg-surface-secondary","aria-autocomplete":"list","aria-expanded":i.length>0,"aria-owns":"address-selector-list"}),b&&r.jsx("div",{className:"mt-2 text-sm text-red-600",children:b}),i.length>0&&r.jsx("ul",{id:"address-selector-list",role:"listbox",className:"absolute z-20 left-0 right-0 mt-2 bg-white border border-border-primary rounded-md shadow-lg max-h-64 overflow-auto",children:i.map((e,t)=>r.jsxs("li",{role:"option","aria-selected":t===u,className:E("px-3 py-2 cursor-pointer hover:bg-surface-primary",t===u?"bg-surface-primary":""),onMouseDown:s=>{s.preventDefault(),A(e)},onMouseEnter:()=>g(t),children:[r.jsx("div",{className:"text-sm font-medium",children:e.structured_formatting.main_text}),r.jsx("div",{className:"text-xs text-text-tertiary",children:e.structured_formatting.secondary_text??e.description})]},e.place_id))})]})};v.__docgenInfo={description:"",methods:[],displayName:"AddressSelector",props:{onSelect:{required:!1,tsType:{name:"signature",type:"function",raw:"(place: PlaceDetails) => void",signature:{arguments:[{type:{name:"PlaceDetails"},name:"place"}],return:{name:"void"}}},description:"onSelect fires when the user chooses a place (place details provided)"},apiKey:{required:!1,tsType:{name:"string"},description:"optional API key (if not provided component will try window.__GMAPS_API_KEY__)"},placeholder:{required:!1,tsType:{name:"string"},description:"",defaultValue:{value:"'Search address'",computed:!1}},className:{required:!1,tsType:{name:"string"},description:"",defaultValue:{value:"''",computed:!1}},minLength:{required:!1,tsType:{name:"number"},description:"minimum characters before querying",defaultValue:{value:"3",computed:!1}}}};const K={title:"Forms/Address Selector",component:v,tags:[]},y={render:c=>r.jsxs("div",{className:"p-6 max-w-md",children:[r.jsxs("p",{className:"mb-4 text-sm text-text-tertiary",children:["Note: provide your Google Maps API key via the story ",r.jsx("strong",{children:"args"})," (set the ",r.jsx("code",{children:"apiKey"})," control) or pass the ",r.jsx("code",{children:"apiKey"})," prop programmatically. The Places API must be enabled for the key."]}),r.jsx(v,{...c,onSelect:n=>alert(JSON.stringify(n,null,2))})]})};y.parameters={...y.parameters,docs:{...y.parameters?.docs,source:{originalSource:`{
  render: args => <div className="p-6 max-w-md">
      <p className="mb-4 text-sm text-text-tertiary">Note: provide your Google Maps API key via the story <strong>args</strong> (set the <code>apiKey</code> control) or pass the <code>apiKey</code> prop programmatically. The Places API must be enabled for the key.</p>
      <AddressSelector {...args} onSelect={place => alert(JSON.stringify(place, null, 2))} />
    </div>
}`,...y.parameters?.docs?.source}}};const R=["Default"];export{y as Default,R as __namedExportsOrder,K as default};
