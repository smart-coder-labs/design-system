import{j as E}from"./jsx-runtime-u17CrQMm.js";import{r as s}from"./iframe-BMG7cCGY.js";import{M as W,a as A,u as I,P as D,b as H,c as K,L as U}from"./proxy-BFHmY9N3.js";function k(e,r){if(typeof e=="function")return e(r);e!=null&&(e.current=r)}function B(...e){return r=>{let t=!1;const i=e.map(f=>{const n=k(f,r);return!t&&typeof n=="function"&&(t=!0),n});if(t)return()=>{for(let f=0;f<i.length;f++){const n=i[f];typeof n=="function"?n():k(e[f],null)}}}}function F(...e){return s.useCallback(B(...e),e)}class G extends s.Component{getSnapshotBeforeUpdate(r){const t=this.props.childRef.current;if(t&&r.isPresent&&!this.props.isPresent){const i=t.offsetParent,f=A(i)&&i.offsetWidth||0,n=this.props.sizeRef.current;n.height=t.offsetHeight||0,n.width=t.offsetWidth||0,n.top=t.offsetTop,n.left=t.offsetLeft,n.right=f-n.width-n.left}return null}componentDidUpdate(){}render(){return this.props.children}}function V({children:e,isPresent:r,anchorX:t,root:i}){const f=s.useId(),n=s.useRef(null),h=s.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:R}=s.useContext(W),P=e.props?.ref??e?.ref,u=F(n,P);return s.useInsertionEffect(()=>{const{width:g,height:c,top:l,left:a,right:m}=h.current;if(r||!n.current||!g||!c)return;const C=t==="left"?`left: ${a}`:`right: ${m}`;n.current.dataset.motionPopId=f;const d=document.createElement("style");R&&(d.nonce=R);const w=i??document.head;return w.appendChild(d),d.sheet&&d.sheet.insertRule(`
          [data-motion-pop-id="${f}"] {
            position: absolute !important;
            width: ${g}px !important;
            height: ${c}px !important;
            ${C}px !important;
            top: ${l}px !important;
          }
        `),()=>{w.contains(d)&&w.removeChild(d)}},[r]),E.jsx(G,{isPresent:r,childRef:n,sizeRef:h,children:s.cloneElement(e,{ref:u})})}const X=({children:e,initial:r,isPresent:t,onExitComplete:i,custom:f,presenceAffectsLayout:n,mode:h,anchorX:R,root:P})=>{const u=I(_),g=s.useId();let c=!0,l=s.useMemo(()=>(c=!1,{id:g,initial:r,isPresent:t,custom:f,onExitComplete:a=>{u.set(a,!0);for(const m of u.values())if(!m)return;i&&i()},register:a=>(u.set(a,!1),()=>u.delete(a))}),[t,u,i]);return n&&c&&(l={...l}),s.useMemo(()=>{u.forEach((a,m)=>u.set(m,!1))},[t]),s.useEffect(()=>{!t&&!u.size&&i&&i()},[t]),h==="popLayout"&&(e=E.jsx(V,{isPresent:t,anchorX:R,root:P,children:e})),E.jsx(D.Provider,{value:l,children:e})};function _(){return new Map}const M=e=>e.key||"";function z(e){const r=[];return s.Children.forEach(e,t=>{s.isValidElement(t)&&r.push(t)}),r}const O=({children:e,custom:r,initial:t=!0,onExitComplete:i,presenceAffectsLayout:f=!0,mode:n="sync",propagate:h=!1,anchorX:R="left",root:P})=>{const[u,g]=H(h),c=s.useMemo(()=>z(e),[e]),l=h&&!u?[]:c.map(M),a=s.useRef(!0),m=s.useRef(c),C=I(()=>new Map),d=s.useRef(new Set),[w,S]=s.useState(c),[x,$]=s.useState(c);K(()=>{a.current=!1,m.current=c;for(let p=0;p<x.length;p++){const o=M(x[p]);l.includes(o)?(C.delete(o),d.current.delete(o)):C.get(o)!==!0&&C.set(o,!1)}},[x,l.length,l.join("-")]);const j=[];if(c!==w){let p=[...c];for(let o=0;o<x.length;o++){const y=x[o],v=M(y);l.includes(v)||(p.splice(o,0,y),j.push(y))}return n==="wait"&&j.length&&(p=j),$(z(p)),S(c),null}const{forceRender:b}=s.useContext(U);return E.jsx(E.Fragment,{children:x.map(p=>{const o=M(p),y=h&&!u?!1:c===x||l.includes(o),v=()=>{if(d.current.has(o))return;if(d.current.add(o),C.has(o))C.set(o,!0);else return;let L=!0;C.forEach(T=>{T||(L=!1)}),L&&(b?.(),$(m.current),h&&g?.(),i&&i())};return E.jsx(X,{isPresent:y,initial:!a.current||t?void 0:!1,custom:r,presenceAffectsLayout:f,mode:n,root:P,onExitComplete:y?void 0:v,anchorX:R,children:p},o)})})};export{O as A};
